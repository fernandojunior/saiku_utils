// Copyright (c) 2015 Fernando Felix do Nascimento Junior
var SaikuUtils=Class.simple_extend({constructor:function(e,t,n){this.rootpath=e||"/pentaho/plugin/saiku/api/";this.username=t;this.cube=n},open:function(e){var t=e.username||this.username;var n=e.queryname;var r=e.cube||this.cube;var i=e.success;var s=e.error;var o=this.rootpath+t+"/query/"+n;var u={catalog:r.catalogName||r.schemaName,connection:r.connectionName||r.schemaName,schema:r.schemaName,cube:r.name};$.post(o,u,function(e,t,n){i(e,t,n)}).fail(function(){console.log(arguments);s(arguments)})},execute:function(e){var t=e.username||this.username;var n=e.queryname;var r=e.open||false;var i=e.cube||this.cube;var s=e.mdx;var o=e.mimetype||"json";var u=e.success;var a=e.error;var f=this;if(r==true)return f.open({username:t,queryname:n,cube:i,success:function(t){delete e["cube"];delete e["open"];f.execute(e)},error:a});var l=this.rootpath+t+"/query/"+n+"/result";$.post(l,{mdx:s},function(e,r,i){if(o!="json")return f.export({username:t,queryname:n,mimetype:o,success:u,error:a});u(e,r,i)}).fail(function(){console.log(arguments);a(arguments)})},"export":function(e){var t=e.username||this.username;var n=e.queryname;var r=e.mimetype;var i=e.success;var s=e.error;var o=this.rootpath+t+"/query/"+n+"/export/"+r;if(r!="csv"&&r!="pdf"&&r!="xls")return console.log("MIME type not suported: "+type);$.get(o,function(e,t,n){i(e,t,n)}).fail(function(){console.log(arguments);s(arguments)})}})
